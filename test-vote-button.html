<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Vote Button - HAG</title>
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://unpkg.com/lucide-react@latest/dist/umd/lucide-react.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', sans-serif; }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState } = React;
        const { Vote, CheckCircle, Loader2 } = lucideReact;

        // Composant VoteButton simplifié
        const VoteButton = ({ candidateId, candidateName, isVoted, isVoting, onVote, disabled = false }) => {
            const handleVoteClick = () => {
                if (!candidateId || !candidateName) {
                    console.error('VoteButton: Données manquantes', { candidateId, candidateName });
                    return;
                }
                onVote(candidateId, candidateName);
            };

            const isButtonDisabled = disabled || isVoted || isVoting;
            const baseStyles = "w-full py-3 px-4 rounded-lg font-medium transition-all duration-200 focus:outline-none focus:ring-2 focus:ring-offset-2";
            
            const getButtonStyles = () => {
                if (isVoted) {
                    return `${baseStyles} bg-green-500 text-white cursor-not-allowed focus:ring-green-500`;
                }
                if (isVoting) {
                    return `${baseStyles} bg-yellow-500 text-white cursor-not-allowed focus:ring-yellow-500`;
                }
                if (isButtonDisabled) {
                    return `${baseStyles} bg-gray-300 text-gray-500 cursor-not-allowed focus:ring-gray-300`;
                }
                return `${baseStyles} bg-blue-600 text-white hover:bg-blue-700 focus:ring-blue-500 active:bg-blue-800`;
            };

            const getButtonContent = () => {
                if (isVoted) {
                    return React.createElement('span', { className: "flex items-center justify-center space-x-2" },
                        React.createElement(CheckCircle, { className: "w-5 h-5" }),
                        React.createElement('span', null, "Voté")
                    );
                }
                
                if (isVoting) {
                    return React.createElement('span', { className: "flex items-center justify-center space-x-2" },
                        React.createElement(Loader2, { className: "w-5 h-5 animate-spin" }),
                        React.createElement('span', null, "Vote en cours...")
                    );
                }
                
                return React.createElement('span', { className: "flex items-center justify-center space-x-2" },
                    React.createElement(Vote, { className: "w-5 h-5" }),
                    React.createElement('span', null, "Voter")
                );
            };

            return React.createElement('button', {
                type: "button",
                onClick: handleVoteClick,
                disabled: isButtonDisabled,
                className: getButtonStyles(),
                'aria-label': isVoted ? `Voté pour ${candidateName}` : `Voter pour ${candidateName}`,
                'data-candidate-id': candidateId,
                'data-candidate-name': candidateName
            }, getButtonContent());
        };

        // Composant de test
        const TestApp = () => {
            const [candidates, setCandidates] = useState([
                { id: 1, name: "Hôtel Mariador Palace", votes: 0, isVoted: false },
                { id: 2, name: "Restaurant Le Bistrot", votes: 0, isVoted: false },
                { id: 3, name: "Spa Relaxation Plus", votes: 0, isVoted: false }
            ]);
            const [votingInProgress, setVotingInProgress] = useState(new Set());
            const [showSuccess, setShowSuccess] = useState(false);
            const [successMessage, setSuccessMessage] = useState('');

            const handleVote = (candidateId, candidateName) => {
                console.log('🔄 Vote pour:', candidateName, 'ID:', candidateId);
                
                const candidate = candidates.find(c => c.id === candidateId);
                if (!candidate) {
                    console.error('❌ Candidat non trouvé:', candidateId);
                    return;
                }
                
                if (candidate.isVoted) {
                    console.warn('⚠️ Déjà voté pour:', candidate.name);
                    return;
                }
                
                if (votingInProgress.has(candidateId)) {
                    console.warn('⚠️ Vote en cours pour:', candidate.name);
                    return;
                }

                setVotingInProgress(prev => new Set(prev).add(candidateId));

                setTimeout(() => {
                    setCandidates(prev => {
                        const updated = prev.map(c => 
                            c.id === candidateId 
                                ? { ...c, votes: c.votes + 1, isVoted: true }
                                : c
                        );
                        return updated;
                    });

                    setSuccessMessage(`Vote enregistré pour ${candidate.name} !`);
                    setShowSuccess(true);
                    
                    setTimeout(() => setShowSuccess(false), 3000);
                    
                    setVotingInProgress(prev => {
                        const newSet = new Set(prev);
                        newSet.delete(candidateId);
                        return newSet;
                    });
                }, 1000);
            };

            const resetVotes = () => {
                setCandidates(prev => prev.map(c => ({ ...c, votes: 0, isVoted: false })));
                setVotingInProgress(new Set());
                setShowSuccess(false);
            };

            return React.createElement('div', { className: "min-h-screen bg-gray-50 p-8" },
                React.createElement('div', { className: "max-w-4xl mx-auto" },
                    React.createElement('h1', { className: "text-3xl font-bold text-center mb-8 text-gray-900" }, "Test du Bouton Voter"),
                    
                    // Message de succès
                    showSuccess && React.createElement('div', { 
                        className: "fixed top-4 right-4 bg-green-500 text-white px-6 py-3 rounded-lg shadow-lg z-50 flex items-center space-x-2" 
                    },
                        React.createElement(CheckCircle, { className: "w-5 h-5" }),
                        React.createElement('span', null, successMessage)
                    ),

                    // Bouton de reset
                    React.createElement('div', { className: "text-center mb-8" },
                        React.createElement('button', {
                            onClick: resetVotes,
                            className: "bg-red-500 text-white px-4 py-2 rounded-lg hover:bg-red-600 transition-colors"
                        }, "Réinitialiser tous les votes")
                    ),

                    // Liste des candidats
                    React.createElement('div', { className: "grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6" },
                        candidates.map(candidate => 
                            React.createElement('div', { 
                                key: candidate.id, 
                                className: "bg-white rounded-2xl shadow-lg border border-gray-100 overflow-hidden hover:shadow-xl transition-shadow p-6" 
                            },
                                React.createElement('h3', { className: "text-xl font-bold text-gray-900 mb-2" }, candidate.name),
                                React.createElement('p', { className: "text-gray-600 mb-4" }, `${candidate.votes} votes`),
                                React.createElement(VoteButton, {
                                    candidateId: candidate.id,
                                    candidateName: candidate.name,
                                    isVoted: candidate.isVoted,
                                    isVoting: votingInProgress.has(candidate.id),
                                    onVote: handleVote,
                                    disabled: false
                                })
                            )
                        )
                    ),

                    // Instructions
                    React.createElement('div', { className: "mt-12 bg-blue-50 rounded-2xl p-8 text-center" },
                        React.createElement('h2', { className: "text-2xl font-bold text-blue-900 mb-4" }, "Instructions de Test"),
                        React.createElement('div', { className: "grid grid-cols-1 md:grid-cols-3 gap-6 text-left" },
                            React.createElement('div', { className: "text-center" },
                                React.createElement('div', { className: "w-16 h-16 bg-blue-100 rounded-full flex items-center justify-center mx-auto mb-4" },
                                    React.createElement(Vote, { className: "w-8 h-8 text-blue-600" })
                                ),
                                React.createElement('h3', { className: "text-lg font-semibold text-blue-900 mb-2" }, "1. Cliquez sur Voter"),
                                React.createElement('p', { className: "text-blue-700" }, "Cliquez sur le bouton bleu pour voter")
                            ),
                            React.createElement('div', { className: "text-center" },
                                React.createElement('div', { className: "w-16 h-16 bg-yellow-100 rounded-full flex items-center justify-center mx-auto mb-4" },
                                    React.createElement(Loader2, { className: "w-8 h-8 text-yellow-600" })
                                ),
                                React.createElement('h3', { className: "text-lg font-semibold text-blue-900 mb-2" }, "2. Attendez"),
                                React.createElement('p', { className: "text-blue-700" }, "Le bouton devient jaune pendant le traitement")
                            ),
                            React.createElement('div', { className: "text-center" },
                                React.createElement('div', { className: "w-16 h-16 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-4" },
                                    React.createElement(CheckCircle, { className: "w-8 h-8 text-green-600" })
                                ),
                                React.createElement('h3', { className: "text-lg font-semibold text-blue-900 mb-2" }, "3. Confirmé"),
                                React.createElement('p', { className: "text-blue-700" }, "Le bouton devient vert et affiche 'Voté'")
                            )
                        )
                    )
                )
            );
        };

        ReactDOM.render(React.createElement(TestApp), document.getElementById('root'));
    </script>
</body>
</html>
